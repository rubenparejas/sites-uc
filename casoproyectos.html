
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Laboratorio de Normalizaci√≥n ‚Äì demo drag&drop</title>

<!-- ============  ESTILOS  ============ -->
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:'Segoe UI',Tahoma,Verdana,sans-serif;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  min-height:100vh;color:#333;padding:24px}
.container{max-width:1300px;margin:0 auto}
.header{color:#fff;text-align:center;background:rgba(255,255,255,.1);
        backdrop-filter:blur(10px);border-radius:20px;padding:28px;margin-bottom:32px}
.header h1{font-size:2.2rem;margin-bottom:8px;text-shadow:2px 2px 4px rgba(0,0,0,.3)}

.phase-tabs{display:flex;gap:4px;margin-bottom:28px;background:#f8f9fa;border-radius:10px;padding:4px}
.phase-tab{flex:1;padding:14px;text-align:center;border-radius:8px;font-weight:700;cursor:pointer;transition:.25s}
.phase-tab.active{background:#667eea;color:#fff}
.phase-tab:hover:not(.active){background:#e3f2fd}

.workspace{display:none;min-height:540px}
.workspace.active{display:block}

.table-container{background:#fff;border:2px solid #dee2e6;border-radius:10px;
                 min-height:180px;padding:14px;margin:14px 0;position:relative}
.table-container.drop-zone{border-color:#667eea;background:#f0f5ff;
                           box-shadow:0 0 10px rgba(102,126,234,.4)}
.table-container.error{border-color:#dc3545;background:#fdecea;animation:shake .4s}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-4px)}75%{transform:translateX(4px)}}

.table-header{background:#667eea;color:#fff;padding:10px;border-radius:5px;margin-bottom:12px;text-align:center;font-weight:700}

.attributes-area{min-height:90px;border:2px dashed #dee2e6;border-radius:8px;padding:14px;transition:.25s}
.attributes-area.has-attributes{border-color:#28a745;background:#f8fff9}
.placeholder{color:#999;font-style:italic;text-align:center;padding:18px;user-select:none}

.attribute{display:inline-block;background:#e3f2fd;border:1px solid #2196f3;border-radius:5px;
           padding:7px 10px;margin:5px;cursor:grab;user-select:none;transition:.2s}
.attribute:hover{background:#bbdefb;transform:translateY(-2px)}
.attribute.dragging{opacity:.6;cursor:grabbing;transform:rotate(3deg);z-index:1000}
.attribute.primary-key{background:#ffe0b2;border-color:#ff9800}
.attribute-info{display:block;font-size:.75rem;color:#555;margin-top:2px}

.controls{display:flex;gap:16px;justify-content:center;margin:24px 0}
.btn{background:#667eea;color:#fff;border:none;padding:10px 22px;border-radius:22px;font-size:1rem;cursor:pointer;transition:.25s}
.btn:hover{background:#5a6fd8;transform:translateY(-2px)}
.btn:disabled{background:#bbb;cursor:not-allowed;transform:none}
.btn-success{background:#28a745}
.btn-success:hover{background:#218838}

.feedback{display:none;padding:14px;border-radius:8px;font-weight:700;margin-top:20px}
.feedback.success{background:#d4edda;color:#155724;border:1px solid #c3e6cb}
.feedback.error  {background:#fdecea;color:#721c24;border:1px solid #f5c6cb}
.feedback.warning{background:#fff3cd;color:#856404;border:1px solid #ffeaa7}
</style>
</head>

<body>
<div class="container">

  <!-- ====== Cabecera ====== -->
  <div class="header"><h1>üß™ Laboratorio de Normalizaci√≥n</h1></div>

  <!-- ====== Tabs ====== -->
  <div class="phase-tabs">
    <div class="phase-tab active" data-phase="analysis">üìä An√°lisis</div>
    <div class="phase-tab"          data-phase="normalization">üîß Normalizaci√≥n</div>
    <div class="phase-tab"          data-phase="denormalization">‚ö° Desnormalizaci√≥n</div>
  </div>

  <!-- ====== Fase 1 ====== -->
  <div id="analysis" class="workspace active">
    <h3>Tabla desnormalizada</h3>
    <div id="originalAttributes" class="table-container">
      <div class="attribute primary-key" draggable="true">EstudianteID<span class="attribute-info">PK</span></div>
      <div class="attribute" draggable="true">NombreEstudiante</div>
      <div class="attribute" draggable="true">EmailEstudiante</div>
      <div class="attribute" draggable="true">CarreraEstudiante</div>
      <div class="attribute primary-key" draggable="true">CursoID<span class="attribute-info">PK</span></div>
      <div class="attribute" draggable="true">NombreCurso</div>
      <div class="attribute" draggable="true">Creditos</div>
      <div class="attribute primary-key" draggable="true">ProfesorID<span class="attribute-info">PK</span></div>
      <div class="attribute" draggable="true">NombreProfesor</div>
      <div class="attribute" draggable="true">DepartamentoProfesor</div>
      <div class="attribute" draggable="true">FechaMatricula</div>
      <div class="attribute" draggable="true">NotaFinal</div>
      <div class="attribute" draggable="true">Semestre</div>
    </div>
    <div class="controls">
      <button class="btn btn-success" onclick="startNormalization()">üöÄ Comenzar normalizaci√≥n</button>
    </div>
  </div>

  <!-- ====== Fase 2 ====== -->
  <div id="normalization" class="workspace">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:28px">
      <div>
        <h3>Atributos disponibles</h3>
        <div id="availableAttributes" class="table-container"></div>
      </div>
      <div>
        <h3>Tablas normalizadas</h3>

        <div class="table-container" data-table-type="estudiante">
          <div class="table-header">Estudiantes</div>
          <div class="attributes-area"><div class="placeholder">‚Üê arrastra aqu√≠</div></div>
        </div>

        <div class="table-container" data-table-type="curso">
          <div class="table-header">Cursos</div>
          <div class="attributes-area"><div class="placeholder">‚Üê arrastra aqu√≠</div></div>
        </div>

        <div class="table-container" data-table-type="profesor">
          <div class="table-header">Profesores</div>
          <div class="attributes-area"><div class="placeholder">‚Üê arrastra aqu√≠</div></div>
        </div>

        <div class="table-container" data-table-type="matricula">
          <div class="table-header">Matriculas</div>
          <div class="attributes-area"><div class="placeholder">‚Üê arrastra aqu√≠</div></div>
        </div>
      </div>
    </div>

    <div id="normalFeedback" class="feedback"></div>
    <div class="controls">
      <button class="btn" onclick="validate()">‚úÖ Validar</button>
    </div>
  </div>

  <!-- ====== Fase 3 (vac√≠a) ====== -->
  <div id="denormalization" class="workspace"><p>‚Ä¶</p></div>
</div>

<!-- ============  JAVASCRIPT  ============ -->
<script>
/* --- configuraci√≥n ‚Äúcorrecta‚Äù para validar demo -------- */
const correct = {
  estudiante:['EstudianteID','NombreEstudiante','EmailEstudiante','CarreraEstudiante'],
  curso     :['CursoID','NombreCurso','Creditos','ProfesorID'],
  profesor  :['ProfesorID','NombreProfesor','DepartamentoProfesor'],
  matricula :['EstudianteID','CursoID','FechaMatricula','NotaFinal','Semestre']
};

/* --- util feedback ------------------------------------- */
function fb(msg,type='success'){
  const box=document.getElementById('normalFeedback');
  box.className='feedback '+type;
  box.textContent=msg;
  box.style.display='block';
}

/* --- cambio de pesta√±as -------------------------------- */
document.querySelector('.phase-tabs').addEventListener('click',e=>{
  if(!e.target.classList.contains('phase-tab')) return;
  document.querySelectorAll('.phase-tab').forEach(t=>t.classList.remove('active'));
  e.target.classList.add('active');

  const phase=e.target.dataset.phase;
  document.querySelectorAll('.workspace').forEach(w=>w.classList.remove('active'));
  document.getElementById(phase).classList.add('active');
  if(phase!=='analysis') rewire();
});

/* --- pasar a fase 2 ------------------------------------ */
function startNormalization(){
  document.querySelector('.phase-tab[data-phase="normalization"]').click();

  const avail=document.getElementById('availableAttributes');
  avail.innerHTML='';
  document.querySelectorAll('#originalAttributes .attribute').forEach(a=>{
    avail.appendChild(a.cloneNode(true));
  });
  rewire();
}

/* ======================================================= */
/* ================  DRAG & DROP  ========================= */
let dragEl=null;

function rewire(){
  /* ‚Äî atributos ‚Äî */
  document.querySelectorAll('.attribute').forEach(a=>{
    a.draggable=true;

    /* quita listeners antiguos */
    a.ondragstart=a.ondragend=a.ondblclick=null;

    a.ondragstart=e=>{
      dragEl=e.target;
      e.dataTransfer.setData('text/plain',' ');   // üü¢ clave
      e.dataTransfer.effectAllowed='move';
      e.target.classList.add('dragging');
    };
    a.ondragend=()=>{a.classList.remove('dragging');dragEl=null};
    a.ondblclick=()=>{document.getElementById('availableAttributes').appendChild(a);rewire();};
  });

  /* ‚Äî zonas de drop (cont + area) ‚Äî */
  document.querySelectorAll('.table-container').forEach(cont=>{
    const area=cont.querySelector('.attributes-area');
    [cont,area].forEach(zone=>{
      zone.ondragover=e=>{e.preventDefault();e.dataTransfer.dropEffect='move'};
      zone.ondragenter=e=>{if(dragEl)cont.classList.add('drop-zone')};
      zone.ondragleave=e=>{if(!cont.contains(e.relatedTarget))cont.classList.remove('drop-zone')};
      zone.ondrop=e=>{
        e.preventDefault();cont.classList.remove('drop-zone');
        if(!dragEl) return;
        handleDrop(cont);
        rewire();
      };
    });
  });
}

function handleDrop(cont){
  const type=cont.dataset.tableType;
  const name=dragEl.textContent.trim();

  if(!correct[type]?.includes(name)){
    fb(`‚ùå ${name} NO pertenece a ${type}`,'error');
    cont.classList.add('error');
    setTimeout(()=>cont.classList.remove('error'),650);
    return;
  }
  const tgt=cont.querySelector('.attributes-area');
  tgt.querySelector('.placeholder')?.remove();
  tgt.classList.add('has-attributes');
  tgt.appendChild(dragEl);
  fb(`‚úÖ ${name} ‚Üí ${type}`,'success');
}

/* ------------------------------------------------------- */
function validate(){
  let ok=true;
  Object.entries(correct).forEach(([t,exp])=>{
    const got=[...document.querySelectorAll(`[data-table-type="${t}"] .attribute`)]
               .map(a=>a.textContent.trim());
    if(JSON.stringify(got.sort())!==JSON.stringify(exp.slice().sort())) ok=false;
  });
  fb(ok?'üéâ Todo correcto':'‚ö†Ô∏è Revisa las tablas',ok?'success':'error');
}
/* inicia drag&drop en fase 1 */
rewire();
</script>
</body>
</html>
